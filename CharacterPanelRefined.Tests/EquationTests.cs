using System;
using System.Collections.Generic;
using System.Linq;
using FFXIVClientStructs.FFXIV.Client.Game;
using FFXIVClientStructs.FFXIV.Client.Game.UI;
using NUnit.Framework;

namespace CharacterPanelRefined.Tests;

public class EquationTests {
    #region Breakpoints

    private List<(int Speed, double GcdScalar)> gcd25Breakpoints = [
        (420, 2.5),
        (442, 2.49),
        (527, 2.48),
        (613, 2.47),
        (698, 2.46),
        (784, 2.45),
        (870, 2.44),
        (955, 2.43),
        (1041, 2.42),
        (1126, 2.41),
        (1212, 2.4),
        (1297, 2.39),
        (1383, 2.38),
        (1468, 2.37),
        (1554, 2.36),
        (1639, 2.35),
        (1725, 2.34),
        (1810, 2.33),
        (1896, 2.32),
        (1982, 2.31),
        (2067, 2.3),
        (2153, 2.29),
        (2238, 2.28),
        (2324, 2.27),
        (2409, 2.26),
        (2495, 2.25),
        (2580, 2.24),
        (2666, 2.23),
        (2751, 2.22),
        (2837, 2.21),
        (2922, 2.2),
        (3008, 2.19),
        (3094, 2.18),
        (3179, 2.17),
        (3265, 2.16),
        (3350, 2.15),
        (3436, 2.14),
        (3521, 2.13),
        (3607, 2.12),
        (3692, 2.11),
        (3778, 2.1),
    ];

    private List<(int Speed, double GcdScalar)> gcd28Breakpoints = [
        (420, 2.8),
        (442, 2.79),
        (506, 2.78),
        (592, 2.77),
        (656, 2.76),
        (741, 2.75),
        (805, 2.74),
        (891, 2.73),
        (976, 2.72),
        (1041, 2.71),
        (1126, 2.7),
        (1190, 2.69),
        (1276, 2.68),
        (1340, 2.67),
        (1426, 2.66),
        (1511, 2.65),
        (1575, 2.64),
        (1661, 2.63),
        (1725, 2.62),
        (1810, 2.61),
        (1875, 2.6),
        (1960, 2.59),
        (2046, 2.58),
        (2110, 2.57),
        (2195, 2.56),
        (2260, 2.55),
        (2345, 2.54),
        (2409, 2.53),
        (2495, 2.52),
        (2580, 2.51),
        (2644, 2.5),
        (2730, 2.49),
        (2794, 2.48),
        (2880, 2.47),
        (2944, 2.46),
        (3029, 2.45),
        (3115, 2.44),
        (3179, 2.43),
        (3265, 2.42),
        (3329, 2.41),
        (3414, 2.4),
        (3478, 2.39),
        (3564, 2.38),
        (3650, 2.37),
        (3714, 2.36),
    ];

    private List<(int Speed, double GcdScalar)> llGcd25Breakpoints = [];

    private List<(int Speed, double GcdScalar)> llGcd28Breakpoints = [];

    private Dictionary<string, List<(int Stat, double Value)>> breakpoints = new() {
        {
            nameof(Equations.CalcDh), [
                (420, 0.000),
                (426, 0.001),
                (431, 0.002),
                (436, 0.003),
                (441, 0.004),
                (446, 0.005),
                (451, 0.006),
                (456, 0.007),
                (461, 0.008),
                (466, 0.009),
                (471, 0.010),
                (476, 0.011),
                (481, 0.012),
                (486, 0.013),
                (491, 0.014),
                (496, 0.015),
                (501, 0.016),
                (506, 0.017),
                (511, 0.018),
                (517, 0.019),
                (522, 0.020),
                (527, 0.021),
                (532, 0.022),
                (537, 0.023),
                (542, 0.024),
                (547, 0.025),
                (552, 0.026),
                (557, 0.027),
                (562, 0.028),
                (567, 0.029),
                (572, 0.030),
                (577, 0.031),
                (582, 0.032),
                (587, 0.033),
                (592, 0.034),
                (597, 0.035),
                (602, 0.036),
                (608, 0.037),
                (613, 0.038),
                (618, 0.039),
                (623, 0.040),
                (628, 0.041),
                (633, 0.042),
                (638, 0.043),
                (643, 0.044),
                (648, 0.045),
                (653, 0.046),
                (658, 0.047),
                (663, 0.048),
                (668, 0.049),
                (673, 0.050),
                (678, 0.051),
                (683, 0.052),
                (688, 0.053),
                (693, 0.054),
                (698, 0.055),
                (704, 0.056),
                (709, 0.057),
                (714, 0.058),
                (719, 0.059),
                (724, 0.060),
                (729, 0.061),
                (734, 0.062),
                (739, 0.063),
                (744, 0.064),
                (749, 0.065),
                (754, 0.066),
                (759, 0.067),
                (764, 0.068),
                (769, 0.069),
                (774, 0.070),
                (779, 0.071),
                (784, 0.072),
                (789, 0.073),
                (795, 0.074),
                (800, 0.075),
                (805, 0.076),
                (810, 0.077),
                (815, 0.078),
                (820, 0.079),
                (825, 0.080),
                (830, 0.081),
                (835, 0.082),
                (840, 0.083),
                (845, 0.084),
                (850, 0.085),
                (855, 0.086),
                (860, 0.087),
                (865, 0.088),
                (870, 0.089),
                (875, 0.090),
                (880, 0.091),
                (886, 0.092),
                (891, 0.093),
                (896, 0.094),
                (901, 0.095),
                (906, 0.096),
                (911, 0.097),
                (916, 0.098),
                (921, 0.099),
                (926, 0.100),
                (931, 0.101),
                (936, 0.102),
                (941, 0.103),
                (946, 0.104),
                (951, 0.105),
                (956, 0.106),
                (961, 0.107),
                (966, 0.108),
                (971, 0.109),
                (976, 0.110),
                (982, 0.111),
                (987, 0.112),
                (992, 0.113),
                (997, 0.114),
                (1002, 0.115),
                (1007, 0.116),
                (1012, 0.117),
                (1017, 0.118),
                (1022, 0.119),
                (1027, 0.120),
                (1032, 0.121),
                (1037, 0.122),
                (1042, 0.123),
                (1047, 0.124),
                (1052, 0.125),
                (1057, 0.126),
                (1062, 0.127),
                (1067, 0.128),
                (1073, 0.129),
                (1078, 0.130),
                (1083, 0.131),
                (1088, 0.132),
                (1093, 0.133),
                (1098, 0.134),
                (1103, 0.135),
                (1108, 0.136),
                (1113, 0.137),
                (1118, 0.138),
                (1123, 0.139),
                (1128, 0.140),
                (1133, 0.141),
                (1138, 0.142),
                (1143, 0.143),
                (1148, 0.144),
                (1153, 0.145),
                (1158, 0.146),
                (1164, 0.147),
                (1169, 0.148),
                (1174, 0.149),
                (1179, 0.150),
                (1184, 0.151),
                (1189, 0.152),
                (1194, 0.153),
                (1199, 0.154),
                (1204, 0.155),
                (1209, 0.156),
                (1214, 0.157),
                (1219, 0.158),
                (1224, 0.159),
                (1229, 0.160),
                (1234, 0.161),
                (1239, 0.162),
                (1244, 0.163),
                (1249, 0.164),
                (1254, 0.165),
                (1260, 0.166),
                (1265, 0.167),
                (1270, 0.168),
                (1275, 0.169),
                (1280, 0.170),
                (1285, 0.171),
                (1290, 0.172),
                (1295, 0.173),
                (1300, 0.174),
                (1305, 0.175),
                (1310, 0.176),
                (1315, 0.177),
                (1320, 0.178),
                (1325, 0.179),
                (1330, 0.180),
                (1335, 0.181),
                (1340, 0.182),
                (1345, 0.183),
                (1351, 0.184),
                (1356, 0.185),
                (1361, 0.186),
                (1366, 0.187),
                (1371, 0.188),
                (1376, 0.189),
                (1381, 0.190),
                (1386, 0.191),
                (1391, 0.192),
                (1396, 0.193),
                (1401, 0.194),
                (1406, 0.195),
                (1411, 0.196),
                (1416, 0.197),
                (1421, 0.198),
                (1426, 0.199),
                (1431, 0.200),
                (1436, 0.201),
                (1442, 0.202),
                (1447, 0.203),
                (1452, 0.204),
                (1457, 0.205),
                (1462, 0.206),
                (1467, 0.207),
                (1472, 0.208),
                (1477, 0.209),
                (1482, 0.210),
                (1487, 0.211),
                (1492, 0.212),
                (1497, 0.213),
                (1502, 0.214),
                (1507, 0.215),
                (1512, 0.216),
                (1517, 0.217),
                (1522, 0.218),
                (1527, 0.219),
                (1532, 0.220),
                (1538, 0.221),
                (1543, 0.222),
                (1548, 0.223),
                (1553, 0.224),
                (1558, 0.225),
                (1563, 0.226),
                (1568, 0.227),
                (1573, 0.228),
                (1578, 0.229),
                (1583, 0.230),
                (1588, 0.231),
                (1593, 0.232),
                (1598, 0.233),
                (1603, 0.234),
                (1608, 0.235),
                (1613, 0.236),
                (1618, 0.237),
                (1623, 0.238),
                (1629, 0.239),
                (1634, 0.240),
                (1639, 0.241),
                (1644, 0.242),
                (1649, 0.243),
                (1654, 0.244),
                (1659, 0.245),
                (1664, 0.246),
                (1669, 0.247),
                (1674, 0.248),
                (1679, 0.249),
                (1684, 0.250),
                (1689, 0.251),
                (1694, 0.252),
                (1699, 0.253),
                (1704, 0.254),
                (1709, 0.255),
                (1714, 0.256),
                (1720, 0.257),
                (1725, 0.258),
                (1730, 0.259),
                (1735, 0.260),
                (1740, 0.261),
                (1745, 0.262),
                (1750, 0.263),
                (1755, 0.264),
                (1760, 0.265),
                (1765, 0.266),
                (1770, 0.267),
                (1775, 0.268),
                (1780, 0.269),
                (1785, 0.270),
                (1790, 0.271),
                (1795, 0.272),
                (1800, 0.273),
                (1805, 0.274),
                (1810, 0.275),
                (1816, 0.276),
                (1821, 0.277),
                (1826, 0.278),
                (1831, 0.279),
                (1836, 0.280),
                (1841, 0.281),
                (1846, 0.282),
                (1851, 0.283),
                (1856, 0.284),
                (1861, 0.285),
                (1866, 0.286),
                (1871, 0.287),
                (1876, 0.288),
                (1881, 0.289),
                (1886, 0.290),
                (1891, 0.291),
                (1896, 0.292),
                (1901, 0.293),
                (1907, 0.294),
                (1912, 0.295),
                (1917, 0.296),
                (1922, 0.297),
                (1927, 0.298),
                (1932, 0.299),
            ]
        }, {
            nameof(Equations.CalcDet), [
                (440, 0),
                (460, 0.001),
                (480, 0.002),
                (500, 0.003),
                (520, 0.004),
                (540, 0.005),
                (560, 0.006),
                (579, 0.007),
                (599, 0.008),
                (619, 0.009),
                (639, 0.01),
                (659, 0.011),
                (679, 0.012),
                (699, 0.013),
                (718, 0.014),
                (738, 0.015),
                (758, 0.016),
                (778, 0.017),
                (798, 0.018),
                (818, 0.019),
                (838, 0.02),
                (857, 0.021),
                (877, 0.022),
                (897, 0.023),
                (917, 0.024),
                (937, 0.025),
                (957, 0.026),
                (977, 0.027),
                (996, 0.028),
                (1016, 0.029),
                (1036, 0.03),
                (1056, 0.031),
                (1076, 0.032),
                (1096, 0.033),
                (1116, 0.034),
                (1135, 0.035),
                (1155, 0.036),
                (1175, 0.037),
                (1195, 0.038),
                (1215, 0.039),
                (1235, 0.04),
                (1255, 0.041),
                (1274, 0.042),
                (1294, 0.043),
                (1314, 0.044),
                (1334, 0.045),
                (1354, 0.046),
                (1374, 0.047),
                (1394, 0.048),
                (1413, 0.049),
                (1433, 0.05),
                (1453, 0.051),
                (1473, 0.052),
                (1493, 0.053),
                (1513, 0.054),
                (1533, 0.055),
                (1552, 0.056),
                (1572, 0.057),
                (1592, 0.058),
                (1612, 0.059),
                (1632, 0.06),
                (1652, 0.061),
                (1672, 0.062),
                (1691, 0.063),
                (1711, 0.064),
                (1731, 0.065),
                (1751, 0.066),
                (1771, 0.067),
                (1791, 0.068),
                (1811, 0.069),
                (1830, 0.07),
                (1850, 0.071),
                (1870, 0.072),
                (1890, 0.073),
                (1910, 0.074),
                (1930, 0.075),
                (1950, 0.076),
                (1969, 0.077),
                (1989, 0.078),
                (2009, 0.079),
                (2029, 0.08),
                (2049, 0.081),
                (2069, 0.082),
                (2089, 0.083),
                (2108, 0.084),
                (2128, 0.085),
                (2148, 0.086),
                (2168, 0.087),
                (2188, 0.088),
                (2208, 0.089),
                (2228, 0.09),
                (2247, 0.091),
                (2267, 0.092),
                (2287, 0.093),
                (2307, 0.094),
                (2327, 0.095),
                (2347, 0.096),
                (2367, 0.097),
                (2386, 0.098),
                (2406, 0.099),
                (2426, 0.1),
                (2446, 0.101),
                (2466, 0.102),
                (2486, 0.103),
                (2506, 0.104),
                (2525, 0.105),
                (2545, 0.106),
                (2565, 0.107),
                (2585, 0.108),
                (2605, 0.109),
                (2625, 0.11),
                (2645, 0.111),
                (2664, 0.112),
                (2684, 0.113),
                (2704, 0.114),
                (2724, 0.115),
                (2744, 0.116),
                (2764, 0.117),
                (2784, 0.118),
                (2803, 0.119),
                (2823, 0.12),
                (2843, 0.121),
                (2863, 0.122),
                (2883, 0.123),
                (2903, 0.124),
                (2923, 0.125),
                (2942, 0.126),
                (2962, 0.127),
                (2982, 0.128),
                (3002, 0.129),
                (3022, 0.13),
                (3042, 0.131),
                (3062, 0.132),
                (3081, 0.133),
                (3101, 0.134),
                (3121, 0.135),
                (3141, 0.136),
                (3161, 0.137),
                (3181, 0.138),
                (3201, 0.139),
                (3220, 0.14),
                (3240, 0.141),
                (3260, 0.142),
                (3280, 0.143),
                (3300, 0.144),
                (3320, 0.145),
                (3340, 0.146),
                (3359, 0.147),
                (3379, 0.148),
                (3399, 0.149),
                (3419, 0.15),
                (3439, 0.151),
                (3459, 0.152),
                (3479, 0.153),
                (3498, 0.154),
                (3518, 0.155),
                (3538, 0.156),
                (3558, 0.157),
                (3578, 0.158),
                (3598, 0.159),
                (3618, 0.16),
                (3637, 0.161),
                (3657, 0.162),
                (3677, 0.163),
                (3697, 0.164),
                (3717, 0.165),
                (3737, 0.166),
                (3757, 0.167),
                (3776, 0.168),
                (3796, 0.169),
            ]
        }, {
            nameof(Equations.CalcCritRate), [
                (420, 0.05),
                (434, 0.051),
                (448, 0.052),
                (462, 0.053),
                (476, 0.054),
                (490, 0.055),
                (504, 0.056),
                (518, 0.057),
                (532, 0.058),
                (546, 0.059),
                (559, 0.060),
                (573, 0.061),
                (587, 0.062),
                (601, 0.063),
                (615, 0.064),
                (629, 0.065),
                (643, 0.066),
                (657, 0.067),
                (671, 0.068),
                (685, 0.069),
                (698, 0.070),
                (712, 0.071),
                (726, 0.072),
                (740, 0.073),
                (754, 0.074),
                (768, 0.075),
                (782, 0.076),
                (796, 0.077),
                (810, 0.078),
                (824, 0.079),
                (837, 0.080),
                (851, 0.081),
                (865, 0.082),
                (879, 0.083),
                (893, 0.084),
                (907, 0.085),
                (921, 0.086),
                (935, 0.087),
                (949, 0.088),
                (963, 0.089),
                (976, 0.090),
                (990, 0.091),
                (1004, 0.092),
                (1018, 0.093),
                (1032, 0.094),
                (1046, 0.095),
                (1060, 0.096),
                (1074, 0.097),
                (1088, 0.098),
                (1102, 0.099),
                (1115, 0.100),
                (1129, 0.101),
                (1143, 0.102),
                (1157, 0.103),
                (1171, 0.104),
                (1185, 0.105),
                (1199, 0.106),
                (1213, 0.107),
                (1227, 0.108),
                (1241, 0.109),
                (1254, 0.110),
                (1268, 0.111),
                (1282, 0.112),
                (1296, 0.113),
                (1310, 0.114),
                (1324, 0.115),
                (1338, 0.116),
                (1352, 0.117),
                (1366, 0.118),
                (1380, 0.119),
                (1393, 0.120),
                (1407, 0.121),
                (1421, 0.122),
                (1435, 0.123),
                (1449, 0.124),
                (1463, 0.125),
                (1477, 0.126),
                (1491, 0.127),
                (1505, 0.128),
                (1519, 0.129),
                (1532, 0.130),
                (1546, 0.131),
                (1560, 0.132),
                (1574, 0.133),
                (1588, 0.134),
                (1602, 0.135),
                (1616, 0.136),
                (1630, 0.137),
                (1644, 0.138),
                (1658, 0.139),
                (1671, 0.140),
                (1685, 0.141),
                (1699, 0.142),
                (1713, 0.143),
                (1727, 0.144),
                (1741, 0.145),
                (1755, 0.146),
                (1769, 0.147),
                (1783, 0.148),
                (1797, 0.149),
                (1810, 0.150),
                (1824, 0.151),
                (1838, 0.152),
                (1852, 0.153),
                (1866, 0.154),
                (1880, 0.155),
                (1894, 0.156),
                (1908, 0.157),
                (1922, 0.158),
                (1936, 0.159),
                (1949, 0.160),
                (1963, 0.161),
                (1977, 0.162),
                (1991, 0.163),
                (2005, 0.164),
                (2019, 0.165),
                (2033, 0.166),
                (2047, 0.167),
                (2061, 0.168),
                (2075, 0.169),
                (2088, 0.170),
                (2102, 0.171),
                (2116, 0.172),
                (2130, 0.173),
                (2144, 0.174),
                (2158, 0.175),
                (2172, 0.176),
                (2186, 0.177),
                (2200, 0.178),
                (2214, 0.179),
                (2227, 0.180),
                (2241, 0.181),
                (2255, 0.182),
                (2269, 0.183),
                (2283, 0.184),
                (2297, 0.185),
                (2311, 0.186),
                (2325, 0.187),
                (2339, 0.188),
                (2353, 0.189),
                (2366, 0.190),
                (2380, 0.191),
                (2394, 0.192),
                (2408, 0.193),
                (2422, 0.194),
                (2436, 0.195),
                (2450, 0.196),
                (2464, 0.197),
                (2478, 0.198),
                (2492, 0.199),
                (2505, 0.200),
                (2519, 0.201),
                (2533, 0.202),
                (2547, 0.203),
                (2561, 0.204),
                (2575, 0.205),
                (2589, 0.206),
                (2603, 0.207),
                (2617, 0.208),
                (2631, 0.209),
                (2644, 0.210),
                (2658, 0.211),
                (2672, 0.212),
                (2686, 0.213),
                (2700, 0.214),
                (2714, 0.215),
                (2728, 0.216),
                (2742, 0.217),
                (2756, 0.218),
                (2770, 0.219),
                (2783, 0.220),
                (2797, 0.221),
                (2811, 0.222),
                (2825, 0.223),
                (2839, 0.224),
                (2853, 0.225),
                (2867, 0.226),
                (2881, 0.227),
                (2895, 0.228),
                (2909, 0.229),
                (2922, 0.230),
                (2936, 0.231),
                (2950, 0.232),
                (2964, 0.233),
                (2978, 0.234),
                (2992, 0.235),
                (3006, 0.236),
                (3020, 0.237),
                (3034, 0.238),
                (3048, 0.239),
                (3061, 0.240),
                (3075, 0.241),
                (3089, 0.242),
                (3103, 0.243),
                (3117, 0.244),
                (3131, 0.245),
                (3145, 0.246),
                (3159, 0.247),
                (3173, 0.248),
                (3187, 0.249),
            ]
        }, {
            nameof(Equations.CalcCritDmg), [
                (420, 1.400),
                (434, 1.401),
                (448, 1.402),
                (462, 1.403),
                (476, 1.404),
                (490, 1.405),
                (504, 1.406),
                (518, 1.407),
                (532, 1.408),
                (546, 1.409),
                (559, 1.410),
                (573, 1.411),
                (587, 1.412),
                (601, 1.413),
                (615, 1.414),
                (629, 1.415),
                (643, 1.416),
                (657, 1.417),
                (671, 1.418),
                (685, 1.419),
                (698, 1.420),
                (712, 1.421),
                (726, 1.422),
                (740, 1.423),
                (754, 1.424),
                (768, 1.425),
                (782, 1.426),
                (796, 1.427),
                (810, 1.428),
                (824, 1.429),
                (837, 1.430),
                (851, 1.431),
                (865, 1.432),
                (879, 1.433),
                (893, 1.434),
                (907, 1.435),
                (921, 1.436),
                (935, 1.437),
                (949, 1.438),
                (963, 1.439),
                (976, 1.440),
                (990, 1.441),
                (1004, 1.442),
                (1018, 1.443),
                (1032, 1.444),
                (1046, 1.445),
                (1060, 1.446),
                (1074, 1.447),
                (1088, 1.448),
                (1102, 1.449),
                (1115, 1.450),
                (1129, 1.451),
                (1143, 1.452),
                (1157, 1.453),
                (1171, 1.454),
                (1185, 1.455),
                (1199, 1.456),
                (1213, 1.457),
                (1227, 1.458),
                (1241, 1.459),
                (1254, 1.460),
                (1268, 1.461),
                (1282, 1.462),
                (1296, 1.463),
                (1310, 1.464),
                (1324, 1.465),
                (1338, 1.466),
                (1352, 1.467),
                (1366, 1.468),
                (1380, 1.469),
                (1393, 1.470),
                (1407, 1.471),
                (1421, 1.472),
                (1435, 1.473),
                (1449, 1.474),
                (1463, 1.475),
                (1477, 1.476),
                (1491, 1.477),
                (1505, 1.478),
                (1519, 1.479),
                (1532, 1.480),
                (1546, 1.481),
                (1560, 1.482),
                (1574, 1.483),
                (1588, 1.484),
                (1602, 1.485),
                (1616, 1.486),
                (1630, 1.487),
                (1644, 1.488),
                (1658, 1.489),
                (1671, 1.490),
                (1685, 1.491),
                (1699, 1.492),
                (1713, 1.493),
                (1727, 1.494),
                (1741, 1.495),
                (1755, 1.496),
                (1769, 1.497),
                (1783, 1.498),
                (1797, 1.499),
                (1810, 1.500),
                (1824, 1.501),
                (1838, 1.502),
                (1852, 1.503),
                (1866, 1.504),
                (1880, 1.505),
                (1894, 1.506),
                (1908, 1.507),
                (1922, 1.508),
                (1936, 1.509),
                (1949, 1.510),
                (1963, 1.511),
                (1977, 1.512),
                (1991, 1.513),
                (2005, 1.514),
                (2019, 1.515),
                (2033, 1.516),
                (2047, 1.517),
                (2061, 1.518),
                (2075, 1.519),
                (2088, 1.520),
                (2102, 1.521),
                (2116, 1.522),
                (2130, 1.523),
                (2144, 1.524),
                (2158, 1.525),
                (2172, 1.526),
                (2186, 1.527),
                (2200, 1.528),
                (2214, 1.529),
                (2227, 1.530),
                (2241, 1.531),
                (2255, 1.532),
                (2269, 1.533),
                (2283, 1.534),
                (2297, 1.535),
                (2311, 1.536),
                (2325, 1.537),
                (2339, 1.538),
                (2353, 1.539),
                (2366, 1.540),
                (2380, 1.541),
                (2394, 1.542),
                (2408, 1.543),
                (2422, 1.544),
                (2436, 1.545),
                (2450, 1.546),
                (2464, 1.547),
                (2478, 1.548),
                (2492, 1.549),
                (2505, 1.550),
                (2519, 1.551),
                (2533, 1.552),
                (2547, 1.553),
                (2561, 1.554),
                (2575, 1.555),
                (2589, 1.556),
                (2603, 1.557),
                (2617, 1.558),
                (2631, 1.559),
                (2644, 1.560),
                (2658, 1.561),
                (2672, 1.562),
                (2686, 1.563),
                (2700, 1.564),
                (2714, 1.565),
                (2728, 1.566),
                (2742, 1.567),
                (2756, 1.568),
                (2770, 1.569),
                (2783, 1.570),
                (2797, 1.571),
                (2811, 1.572),
                (2825, 1.573),
                (2839, 1.574),
                (2853, 1.575),
                (2867, 1.576),
                (2881, 1.577),
                (2895, 1.578),
                (2909, 1.579),
                (2922, 1.580),
                (2936, 1.581),
                (2950, 1.582),
                (2964, 1.583),
                (2978, 1.584),
                (2992, 1.585),
                (3006, 1.586),
                (3020, 1.587),
                (3034, 1.588),
                (3048, 1.589),
                (3061, 1.590),
                (3075, 1.591),
                (3089, 1.592),
                (3103, 1.593),
                (3117, 1.594),
                (3131, 1.595),
                (3145, 1.596),
                (3159, 1.597),
                (3173, 1.598),
                (3187, 1.599),
            ]
        }
    };

    #endregion

    [Test]
    public void TestBreakpoints() {
        foreach (var (name, brkpnts) in breakpoints) {
            var equation = typeof(Equations).GetMethod(name)!;

            var n = 0;
            var lbp = brkpnts[0];
            var nbp = brkpnts[1];
            var statInfo = new StatInfo();
            var lvlModifier = LevelModifiers.LevelTable[100];
            for (var stat = lbp.Stat; stat < brkpnts.Last().Stat; stat++) {
                if (stat >= nbp.Stat) {
                    lbp = nbp;
                    nbp = brkpnts[++n + 1];
                }

                var args = new object[] { stat, statInfo, lvlModifier };
                equation.Invoke(null, args);
                statInfo = (StatInfo)args[1];

                Assert.AreEqual(lbp.Value, statInfo.DisplayValue, "{0}: Value is off for {1}", name, stat);
                Assert.AreEqual(lbp.Stat, statInfo.PrevTier, "{0}: PrevTier is off for {1}", name, stat);
                Assert.AreEqual(nbp.Stat, statInfo.NextTier, "{0}: NextTier is off for {1}", name, stat);
            }
        }
    }


    [Test]
    public void TestGcdBreakpoints() {
        var n = 0;
        var lbp = gcd25Breakpoints[0];
        var nbp = gcd25Breakpoints[1];
        var j = 0;
        var lbp28 = gcd28Breakpoints[0];
        var nbp28 = gcd28Breakpoints[1];
        var statInfo = new StatInfo();
        var gcd25 = new StatInfo();
        var gcd28 = new StatInfo();
        var lvlModifier = LevelModifiers.LevelTable[100];
        var altGcd = new AlternateGcd(280, "Fire IV");
        for (var speed = 420; speed < 3700; speed++) {
            if (speed >= nbp.Speed) {
                lbp = nbp;
                nbp = gcd25Breakpoints[++n + 1];
            }

            if (speed >= nbp28.Speed) {
                lbp28 = nbp28;
                nbp28 = gcd28Breakpoints[++j + 1];
            }

            Equations.CalcSpeed(speed, ref statInfo, ref gcd25, ref gcd28, lvlModifier, altGcd, null, out var baseModGcd, out var altBaseModGcd);

            Assert.AreEqual(250, baseModGcd, "Base GCD is off for {0}", speed);
            Assert.AreEqual(280, altBaseModGcd, "Alt Base GCD is off for {0}", speed);

            Assert.AreEqual(lbp.GcdScalar, gcd25.DisplayValue, "GCD is off for {0}", speed);
            Assert.AreEqual(lbp.Speed, gcd25.PrevTier, "PrevTier is off for {0}", speed);
            Assert.AreEqual(nbp.Speed, gcd25.NextTier, "NextTier is off for {0}", speed);

            Assert.AreEqual(lbp28.GcdScalar, gcd28.DisplayValue, "GCD is off for {0}", speed);
            Assert.AreEqual(lbp28.Speed, gcd28.PrevTier, "PrevTier is off for {0}", speed);
            Assert.AreEqual(nbp28.Speed, gcd28.NextTier, "NextTier is off for {0}", speed);
        }
    }

    [Test]
    public void TestLevelModifiers() {
        Assert.AreEqual(195, LevelModifiers.AttackModifier(90));
        Assert.AreEqual(156, LevelModifiers.TankAttackModifier(90));
        Assert.AreEqual(24.3, LevelModifiers.HpModifier(90));
        Assert.AreEqual(34.6, LevelModifiers.TankHpModifier(90));
        Assert.AreEqual(237, LevelModifiers.AttackModifier(100));
        Assert.AreEqual(190, LevelModifiers.TankAttackModifier(100));
        Assert.AreEqual(30.1, LevelModifiers.HpModifier(100));
        Assert.AreEqual(43, LevelModifiers.TankHpModifier(100));
    }

    [Test]
    public unsafe void TestExpectedOutput() {
        var expectedValues = new List<(ushort Wd, int Mnd, int Det, int ExpectedDamage, int ExpectedHeal)> {
            (126, 2940, 1788, 3417, 2566),
            (126, 3028, 1788, 3527, 2646),
            (126, 3057, 1788, 3560, 2671),
            (119, 2669, 1743, 2940, 2213),
            (113, 2309, 1734, 2420, 1830)
        };

        var inventoryManager = new InventoryManager();
        InventoryManager.Addresses.Instance.Value = (nint)(&inventoryManager);

        var uiState = new UIState();
        uiState.PlayerState.CurrentLevel = 90;
        var statInfo = new StatInfo();
        var levelModifier = LevelModifiers.LevelTable[90];

        foreach (var (wd, mnd, det, expectedDmg, expectedHeal) in expectedValues) {
            ((ushort*)((IntPtr)(&inventoryManager) + 9272))[17] = wd;
            uiState.PlayerState.Attributes[(int)Attributes.AttackMagicPotency] = mnd;
            var detVal = Equations.CalcDet(det, ref statInfo, levelModifier);

            var result = Equations.CalcExpectedOutput(&uiState, JobId.WHM, detVal, 1.4, 0.05, 0, 0, levelModifier, null, IlvlSyncType.Strict);

            Assert.AreEqual(expectedDmg, result.AvgDamage, "Damage is off for {0}|{1}|{2}", wd, mnd, det);
            Assert.AreEqual(expectedHeal, result.NormalHeal, "Heal is off for {0}|{1}|{2}", wd, mnd, det);
        }
    }
}
